Its been quite a pain finding information about how to connect and deal with cameras on the rockchip based sbc of the rock5b. In this blogost we are going step by step how to enable it.

This tutorial builds on Ubuntu 24.04 LTS but can be adapted to other releases.

1. Add the device tree file to uboot sudo nano /etc/default/u-boot
```sh
sudo  nano /etc/default/u-boot
```

Add the following lines (this might be different depending on kernel version):
```
U_BOOT_FDT_OVERLAYS="rock-5b-radxa-camera-4k.dtbo"
U_BOOT_FDT_OVERLAYS_DIR="/lib/firmware/6.1.0-1025-rockchip/device-tree/rockchip/overlay/"
```
2. Connect the camera
2. Reboot
3. Check that device is found
```bash
sudo dmesg | grep "imx" # should show "Detected imx415"
```
My output:
```
[    8.896409] imx415 3-001a: Detected imx415 id 0000e0
[    8.939825] imx415 3-001a: Consider updating driver imx415 to match on endpoints
[    8.939829] rockchip-csi2-dphy csi2-dphy0: dphy0 matches m00_b_imx415 3-001a:bus type 5
[   11.348308] imx415 3-001a: set hdr cfg, set mode to 0
[   11.348318] imx415 3-001a: set fmt: cur_mode: 3864x2192, hdr: 0, bpp: 10
```

```bash
sudo media-ctl -p
```
Shows something like:
```plain
- entity 63: m00_b_imx415 3-001a (1 pad, 1 link, 0 routes)
             type V4L2 subdev subtype Sensor flags 0
             device node name /dev/v4l-subdev2
	pad0: Source
		[stream:0 fmt:SGBRG10_1X10/3864x2192@10000/300000 field:none
		 crop.bounds:(12,16)/3840x2160]
		-> "rockchip-csi2-dphy0":0 [ENABLED]
```
4. Take a shot
```bash
ffmpeg -f v4l2 -i /dev/video11 -vframes 1 test.jpg
```


Note: I am still facing the problem that the color mode somehow is note correct and that there needs to be a lot more red inside the image. 
